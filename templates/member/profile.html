{% extends 'base.html' %}

{% block page_title %}Profil Ayarlarƒ±{% endblock %}
{% block page_description %}Profil bilgilerinizi d√ºzenleyin ve g√ºncelleyin{% endblock %}

{% block content %}
<div class="p-6 overflow-y-auto h-full custom-scrollbar">
    <div class="max-w-6xl mx-auto">
        
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Sol Taraf: Profil Kartƒ± ve ƒ∞statistikler -->
            <div class="lg:col-span-1 space-y-8">
                <!-- Profil Kartƒ± -->
                <div class="glass-effect rounded-3xl p-8 border border-white/20 text-center relative overflow-hidden">
                    <!-- Background Pattern -->
                    <div class="absolute inset-0 opacity-5">
                        <div class="absolute top-0 right-0 w-20 h-20 bg-pink-500 rounded-full animate-float"></div>
                        <div class="absolute bottom-0 left-0 w-16 h-16 bg-rose-500 rounded-full animate-float" style="animation-delay: 1s"></div>
                    </div>
                    
                    <div class="relative z-10">
                        <div class="relative inline-block mb-6">
                            <div class="w-32 h-32 mx-auto rounded-full overflow-hidden bg-gradient-to-r from-pink-500 to-rose-500 flex items-center justify-center shadow-2xl border-4 border-white/50 dark:border-gray-800/50 transition-transform duration-300 hover:scale-105">
                                {% if user.profile.avatar %}
                                    <img id="avatarImage" src="{{ user.profile.avatar.url }}" alt="Profil" class="w-full h-full object-cover">
                                {% else %}
                                    <span class="text-white text-4xl font-bold">{{ user.first_name.0|default:user.username.0 }}</span>
                                {% endif %}
                            </div>
                            <label for="id_avatar" class="absolute bottom-0 right-0 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-full p-3 hover:from-pink-600 hover:to-rose-600 transition-all duration-200 shadow-xl cursor-pointer transform hover:scale-110 group">
                                <svg class="w-5 h-5 transition-transform group-hover:rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </label>
                            <!-- Status indicator -->
                            <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 px-3 py-1 bg-green-500 text-white text-xs rounded-full flex items-center space-x-1 animate-bounce-soft">
                                <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
                                <span>Aktif</span>
                            </div>
                        </div>
                        
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">{{ user.get_full_name|default:user.username }}</h2>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">{{ user.email }}</p>
                        
                        <div class="inline-flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-pink-50 to-rose-50 dark:from-pink-900/20 dark:to-rose-900/20 border border-pink-200 dark:border-pink-800 rounded-full">
                            <div class="w-3 h-3 bg-gradient-to-r from-pink-500 to-rose-500 rounded-full"></div>
                            <span class="text-sm font-medium text-pink-800 dark:text-pink-200">{{ user.profile.get_membership_display }}</span>
                        </div>
                        
                        <hr class="my-6 border-gray-200 dark:border-gray-700">

                        <!-- ƒ∞statistikler Grid -->
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="text-center p-4 glass-effect rounded-xl border border-white/10 hover:border-pink-200 dark:hover:border-pink-800 transition-all duration-300">
                                <div class="text-2xl font-bold text-gray-900 dark:text-white">{{ user.date_joined|timesince }}</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">√úyelik S√ºresi</div>
                            </div>
                            <div class="text-center p-4 glass-effect rounded-xl border border-white/10 hover:border-pink-200 dark:hover:border-pink-800 transition-all duration-300">
                                <div class="text-2xl font-bold text-gray-900 dark:text-white">{{ user.messages.count }}</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Toplam Mesaj</div>
                            </div>
                            <div class="text-center p-4 glass-effect rounded-xl border border-white/10 hover:border-pink-200 dark:hover:border-pink-800 transition-all duration-300">
                                <div class="text-2xl font-bold text-gray-900 dark:text-white">{{ completed_solutions_count }}</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Tamamlanan</div>
                            </div>
                            <div class="text-center p-4 glass-effect rounded-xl border border-white/10 hover:border-pink-200 dark:hover:border-pink-800 transition-all duration-300">
                                <div class="text-2xl font-bold text-gradient">%{{ completed_solutions_count|floatformat:0 }}</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400">Ba≈üarƒ± Oranƒ±</div>
                            </div>
                        </div>

                        <!-- Hƒ±zlƒ± Eylemler -->
                        <div class="space-y-3">
                            <a href="{% url 'core:chat' %}" class="block w-full px-4 py-3 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-xl hover:from-pink-600 hover:to-rose-600 transition-all duration-200 transform hover:scale-105 shadow-lg text-center font-medium">
                                üí¨ Sohbet Ba≈ülat
                            </a>
                            <a href="{% url 'member:avatar_create' %}" class="block w-full px-4 py-3 glass-effect rounded-xl hover:bg-white/30 dark:hover:bg-gray-700/30 transition-all duration-200 text-gray-700 dark:text-gray-300 text-center font-medium border border-white/20">
                                üé® Avatar D√ºzenle
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Ba≈üarƒ± Rozetleri -->
                <div class="glass-effect rounded-2xl p-6 border border-white/20">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4 flex items-center space-x-2">
                        <span>üèÜ</span>
                        <span>Ba≈üarƒ± Rozetleri</span>
                    </h3>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="text-center p-3 glass-effect rounded-xl border border-white/10 group hover:border-yellow-300 dark:hover:border-yellow-700 transition-all duration-300">
                            <div class="text-2xl mb-1 group-hover:scale-110 transition-transform">ü•á</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">ƒ∞lk √á√∂z√ºm</div>
                        </div>
                        <div class="text-center p-3 glass-effect rounded-xl border border-white/10 group hover:border-blue-300 dark:hover:border-blue-700 transition-all duration-300">
                            <div class="text-2xl mb-1 group-hover:scale-110 transition-transform">üìö</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">√ñƒürenci</div>
                        </div>
                        <div class="text-center p-3 glass-effect rounded-xl border border-white/10 group hover:border-green-300 dark:hover:border-green-700 transition-all duration-300">
                            <div class="text-2xl mb-1 group-hover:scale-110 transition-transform">‚≠ê</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">Aktif</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Saƒü Taraf: Ayarlar Formu -->
            <div class="lg:col-span-2">
                <div class="glass-effect rounded-3xl border border-white/20 overflow-hidden">
                    <!-- Sekme Ba≈ülƒ±klarƒ± -->
                    <div class="border-b border-gray-200 dark:border-gray-700 px-6 bg-gradient-to-r from-pink-50/50 to-rose-50/50 dark:from-pink-900/10 dark:to-rose-900/10">
                        <nav class="flex space-x-8 -mb-px">
                            <button type="button" onclick="changeTab('profil')" class="tab-button active-tab group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200">
                                <svg class="text-pink-500 -ml-0.5 mr-2 h-5 w-5 transition-transform group-hover:scale-110" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>
                                <span>Profil Bilgileri</span>
                            </button>
                            <button type="button" onclick="changeTab('tercihler')" class="tab-button inactive-tab group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200">
                                <svg class="text-gray-400 group-hover:text-gray-500 -ml-0.5 mr-2 h-5 w-5 transition-all duration-200 group-hover:scale-110" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/></svg>
                                <span>Tercihler</span>
                            </button>
                            <button type="button" onclick="changeTab('guvenlik')" class="tab-button inactive-tab group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200">
                                <svg class="text-gray-400 group-hover:text-gray-500 -ml-0.5 mr-2 h-5 w-5 transition-all duration-200 group-hover:scale-110" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg>
                                <span>G√ºvenlik</span>
                            </button>
                        </nav>
                    </div>

                    <form method="post" enctype="multipart/form-data" id="profileForm">
                        {% csrf_token %}
                        <!-- Hidden avatar input -->
                        <div class="hidden">{{ profile_form.avatar }}</div>

                        <!-- Sekme ƒ∞√ßerikleri -->
                        <div class="p-8 space-y-8">
                            <!-- Profil Bilgileri Sekmesi -->
                            <div id="profil" class="tab-content space-y-6">
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <label for="{{ user_form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center space-x-1">
                                            <span>üë§</span>
                                            <span>Ad</span>
                                        </label>
                                        {{ user_form.first_name }}
                                        {% if user_form.first_name.errors %}
                                            <div class="text-red-500 text-sm">{{ user_form.first_name.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                    <div class="space-y-2">
                                        <label for="{{ user_form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center space-x-1">
                                            <span>üë§</span>
                                            <span>Soyad</span>
                                        </label>
                                        {{ user_form.last_name }}
                                        {% if user_form.last_name.errors %}
                                            <div class="text-red-500 text-sm">{{ user_form.last_name.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label for="{{ user_form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center space-x-1">
                                        <span>üìß</span>
                                        <span>E-posta</span>
                                    </label>
                                    {{ user_form.email }}
                                    {% if user_form.email.errors %}
                                        <div class="text-red-500 text-sm">{{ user_form.email.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                <div class="space-y-2">
                                    <label for="{{ profile_form.phone.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center space-x-1">
                                        <span>üì±</span>
                                        <span>Telefon</span>
                                    </label>
                                    {{ profile_form.phone }}
                                    {% if profile_form.phone.errors %}
                                        <div class="text-red-500 text-sm">{{ profile_form.phone.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                <div class="space-y-2">
                                    <label for="{{ profile_form.bio.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center space-x-1">
                                        <span>üìù</span>
                                        <span>Hakkƒ±nda</span>
                                    </label>
                                    {{ profile_form.bio }}
                                    <div class="flex justify-between items-center">
                                        <p class="text-xs text-gray-500 dark:text-gray-400">Kendiniz hakkƒ±nda kƒ±sa bilgi verin</p>
                                        <span id="bioCounter" class="text-xs text-gray-400">0/500</span>
                                    </div>
                                    {% if profile_form.bio.errors %}
                                        <div class="text-red-500 text-sm">{{ profile_form.bio.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <label for="{{ profile_form.birth_date.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center space-x-1">
                                            <span>üéÇ</span>
                                            <span>Doƒüum Tarihi</span>
                                        </label>
                                        {{ profile_form.birth_date }}
                                        {% if profile_form.birth_date.errors %}
                                            <div class="text-red-500 text-sm">{{ profile_form.birth_date.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                    <div class="space-y-2">
                                        <label for="{{ profile_form.gender.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center space-x-1">
                                            <span>‚ößÔ∏è</span>
                                            <span>Cinsiyet</span>
                                        </label>
                                        {{ profile_form.gender }}
                                        {% if profile_form.gender.errors %}
                                            <div class="text-red-500 text-sm">{{ profile_form.gender.errors.0 }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Tercihler Sekmesi -->
                            <div id="tercihler" class="tab-content hidden space-y-6">
                                <div class="space-y-6">
                                    <div class="flex items-center justify-between p-6 glass-effect rounded-xl border border-white/10 hover:border-green-300 dark:hover:border-green-700 transition-all duration-300 group">
                                        <div class="flex items-center space-x-4">
                                            <div class="p-3 bg-green-500/20 rounded-xl group-hover:bg-green-500/30 transition-colors">
                                                <span class="text-2xl">üîî</span>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900 dark:text-white">Bildirimler</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Yeni mesajlar ve g√ºncellemeler i√ßin bildirim al</p>
                                            </div>
                                        </div>
                                        <div class="relative">
                                            {{ profile_form.notification_enabled }}
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between p-6 glass-effect rounded-xl border border-white/10 hover:border-purple-300 dark:hover:border-purple-700 transition-all duration-300 group">
                                        <div class="flex items-center space-x-4">
                                            <div class="p-3 bg-purple-500/20 rounded-xl group-hover:bg-purple-500/30 transition-colors">
                                                <span class="text-2xl">üåô</span>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900 dark:text-white">Karanlƒ±k Mod</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">G√∂z yorgunluƒüunu azaltmak i√ßin karanlƒ±k temayƒ± etkinle≈ütir</p>
                                            </div>
                                        </div>
                                        <div class="relative">
                                            {{ profile_form.dark_mode }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- G√ºvenlik Sekmesi -->
                            <div id="guvenlik" class="tab-content hidden space-y-6">
                                <div class="space-y-4">
                                    <button type="button" class="w-full text-left p-6 glass-effect rounded-xl hover:bg-white/30 dark:hover:bg-gray-700/30 transition-all duration-200 border border-white/10 hover:border-blue-300 dark:hover:border-blue-700 group">
                                        <div class="flex items-center space-x-4">
                                            <div class="p-3 bg-blue-500/20 rounded-xl group-hover:bg-blue-500/30 transition-colors">
                                                <span class="text-2xl">üîë</span>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900 dark:text-white">≈ûifre Deƒüi≈ütir</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Hesap g√ºvenliƒüinizi artƒ±rmak i√ßin ≈üifrenizi d√ºzenli olarak deƒüi≈ütirin</p>
                                            </div>
                                            <div class="ml-auto">
                                                <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                                </svg>
                                            </div>
                                        </div>
                                    </button>
                                    <button type="button" class="w-full text-left p-6 glass-effect rounded-xl hover:bg-white/30 dark:hover:bg-gray-700/30 transition-all duration-200 border border-white/10 hover:border-yellow-300 dark:hover:border-yellow-700 group">
                                        <div class="flex items-center space-x-4">
                                            <div class="p-3 bg-yellow-500/20 rounded-xl group-hover:bg-yellow-500/30 transition-colors">
                                                <span class="text-2xl">üìä</span>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-gray-900 dark:text-white">Verilerinizi ƒ∞ndirin</h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400">Hesabƒ±nƒ±zla ili≈ükili t√ºm verilerin bir kopyasƒ±nƒ± indirin</p>
                                            </div>
                                            <div class="ml-auto">
                                                <svg class="w-5 h-5 text-gray-400 group-hover:text-yellow-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                                </svg>
                                            </div>
                                        </div>
                                    </button>
                                    <button type="button" class="w-full text-left p-6 glass-effect rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 transition-all duration-200 border border-white/10 hover:border-red-300 dark:hover:border-red-700 group">
                                        <div class="flex items-center space-x-4">
                                            <div class="p-3 bg-red-500/20 rounded-xl group-hover:bg-red-500/30 transition-colors">
                                                <span class="text-2xl">‚ö†Ô∏è</span>
                                            </div>
                                            <div>
                                                <h4 class="font-medium text-red-600 dark:text-red-400">Hesabƒ± Sil</h4>
                                                <p class="text-sm text-red-500 dark:text-red-400">Bu i≈ülem geri alƒ±namaz. T√ºm verileriniz kalƒ±cƒ± olarak silinir</p>
                                            </div>
                                            <div class="ml-auto">
                                                <svg class="w-5 h-5 text-red-400 group-hover:text-red-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                                </svg>
                                            </div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Kaydet Butonu -->
                        <div class="p-6 bg-gradient-to-r from-gray-50 to-pink-50 dark:from-gray-900/50 dark:to-pink-900/10 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <div class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span>Deƒüi≈üiklikler otomatik kaydedilir</span>
                            </div>
                            <button type="submit" id="saveButton" class="px-8 py-3 bg-gradient-to-r from-pink-500 to-rose-500 text-white rounded-xl hover:from-pink-600 hover:to-rose-600 transition-all duration-200 transform hover:scale-105 shadow-lg flex items-center space-x-2 btn-hover">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                                <span>Deƒüi≈üiklikleri Kaydet</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Tab Management
    const activeTabClasses = 'border-pink-500 text-pink-600';
    const inactiveTabClasses = 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600';

    function changeTab(tabId) {
        // Hide all tab contents with animation
        document.querySelectorAll('.tab-content').forEach(tab => {
            if (!tab.classList.contains('hidden')) {
                tab.style.opacity = '0';
                tab.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    tab.classList.add('hidden');
                }, 150);
            }
        });

        // Update all tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            button.className = button.className.replace(activeTabClasses, inactiveTabClasses);
        });

        // Show target tab with animation
        setTimeout(() => {
            const targetTab = document.getElementById(tabId);
            targetTab.classList.remove('hidden');
            targetTab.style.opacity = '0';
            targetTab.style.transform = 'translateY(10px)';
            
            requestAnimationFrame(() => {
                targetTab.style.transition = 'all 0.3s ease-out';
                targetTab.style.opacity = '1';
                targetTab.style.transform = 'translateY(0)';
            });

            // Update active tab button
            const activeButton = document.querySelector(`button[onclick="changeTab('${tabId}')"]`);
            activeButton.className = activeButton.className.replace(inactiveTabClasses, activeTabClasses);
            
            // Store active tab
            localStorage.setItem('activeProfileTab', tabId);
        }, 150);
    }

    // Avatar Preview with Enhanced Effects
    document.getElementById('id_avatar').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const avatarImage = document.getElementById('avatarImage');
        const avatarContainer = avatarImage.parentElement;
        
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                // Add loading animation
                avatarContainer.style.filter = 'blur(5px)';
                avatarContainer.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    avatarImage.src = e.target.result;
                    avatarContainer.style.filter = 'none';
                    avatarContainer.style.transform = 'scale(1)';
                    
                    // Show success notification
                    if (window.BinaryGirls && window.BinaryGirls.notifications) {
                        window.BinaryGirls.notifications.success('Avatar ba≈üarƒ±yla g√ºncellendi! üì∏');
                    }
                }, 300);
            };
            reader.readAsDataURL(file);
        }
    });

    // Enhanced Form Handling
    const profileForm = document.getElementById('profileForm');
    const saveButton = document.getElementById('saveButton');
    let isFormDirty = false;
    let autoSaveTimeout;

    // Track form changes
    profileForm.addEventListener('input', function(e) {
        isFormDirty = true;
        updateSaveButton();
        
        // Auto-save after 2 seconds of inactivity
        clearTimeout(autoSaveTimeout);
        autoSaveTimeout = setTimeout(() => {
            if (isFormDirty) {
                autoSaveForm();
            }
        }, 2000);
    });

    function updateSaveButton() {
        if (isFormDirty) {
            saveButton.classList.remove('opacity-50');
            saveButton.disabled = false;
            saveButton.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span>Deƒüi≈üiklikleri Kaydet</span>
            `;
        } else {
            saveButton.classList.add('opacity-50');
            saveButton.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span>Kaydedildi</span>
            `;
        }
    }

    async function autoSaveForm() {
        if (!isFormDirty) return;

        const formData = new FormData(profileForm);
        
        try {
            const response = await fetch(profileForm.action || window.location.href, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });

            if (response.ok) {
                isFormDirty = false;
                updateSaveButton();
                
                if (window.BinaryGirls && window.BinaryGirls.notifications) {
                    window.BinaryGirls.notifications.success('Deƒüi≈üiklikler otomatik kaydedildi! ‚úÖ', 2000);
                }
            }
        } catch (error) {
            console.error('Auto-save failed:', error);
        }
    }

    // Bio character counter
    const bioField = document.querySelector('textarea[name="bio"]');
    const bioCounter = document.getElementById('bioCounter');
    
    if (bioField && bioCounter) {
        function updateBioCounter() {
            const length = bioField.value.length;
            const maxLength = 500;
            bioCounter.textContent = `${length}/${maxLength}`;
            
            if (length > maxLength * 0.8) {
                bioCounter.classList.add('text-orange-500');
                bioCounter.classList.remove('text-gray-400');
            } else if (length > maxLength * 0.9) {
                bioCounter.classList.add('text-red-500');
                bioCounter.classList.remove('text-orange-500', 'text-gray-400');
            } else {
                bioCounter.classList.remove('text-orange-500', 'text-red-500');
                bioCounter.classList.add('text-gray-400');
            }
        }
        
        bioField.addEventListener('input', updateBioCounter);
        updateBioCounter(); // Initial count
    }

    // Toggle Switch Enhancement
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        const wrapper = document.createElement('div');
        wrapper.className = 'relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus-within:ring-2 focus-within:ring-pink-500 focus-within:ring-offset-2';
        
        const updateStyles = () => {
            if (checkbox.checked) {
                wrapper.className = wrapper.className.replace('bg-gray-200', 'bg-pink-500');
                wrapper.style.backgroundColor = '#ec4899';
            } else {
                wrapper.style.backgroundColor = '#e5e7eb';
            }
        };
        
        checkbox.parentNode.insertBefore(wrapper, checkbox);
        wrapper.appendChild(checkbox);
        
        const thumb = document.createElement('span');
        thumb.className = 'inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 ease-in-out';
        wrapper.appendChild(thumb);
        
        const updateThumb = () => {
            if (checkbox.checked) {
                thumb.style.transform = 'translateX(20px)';
            } else {
                thumb.style.transform = 'translateX(2px)';
            }
        };
        
        checkbox.addEventListener('change', () => {
            updateStyles();
            updateThumb();
        });
        
        // Hide original checkbox
        checkbox.style.opacity = '0';
        checkbox.style.position = 'absolute';
        checkbox.style.pointerEvents = 'none';
        
        // Initial state
        updateStyles();
        updateThumb();
    });

    // Form submission with enhanced feedback
    profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const submitButton = saveButton;
        
        // Show loading state
        const originalContent = submitButton.innerHTML;
        submitButton.innerHTML = `
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                <span>Kaydediliyor...</span>
            </div>
        `;
        submitButton.disabled = true;
        
        fetch(this.action || window.location.href, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                isFormDirty = false;
                updateSaveButton();
                
                if (window.BinaryGirls && window.BinaryGirls.notifications) {
                    window.BinaryGirls.notifications.success('Profil ba≈üarƒ±yla g√ºncellendi! üéâ');
                }
            } else {
                throw new Error(data.error || 'Bir hata olu≈ütu');
            }
        })
        .catch(error => {
            console.error('Submit failed:', error);
            if (window.BinaryGirls && window.BinaryGirls.notifications) {
                window.BinaryGirls.notifications.error('G√ºncelleme sƒ±rasƒ±nda bir hata olu≈ütu. L√ºtfen tekrar deneyin.');
            }
        })
        .finally(() => {
            submitButton.innerHTML = originalContent;
            submitButton.disabled = false;
        });
    });

    // Prevent data loss
    window.addEventListener('beforeunload', function(e) {
        if (isFormDirty) {
            e.preventDefault();
            e.returnValue = 'Kaydedilmemi≈ü deƒüi≈üiklikler var. Sayfadan √ßƒ±kmak istediƒüinizden emin misiniz?';
        }
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Load saved tab or default to 'profil'
        const savedTab = localStorage.getItem('activeProfileTab') || 'profil';
        changeTab(savedTab);
        
        // Initial form state
        updateSaveButton();
    });
</script>

<style>
/* Enhanced Tab Transitions */
.tab-content {
    transition: all 0.3s ease-out;
}

/* Custom Toggle Switch */
input[type="checkbox"] + span {
    transition: transform 0.2s ease-in-out;
}

/* Avatar hover effects */
#avatarImage {
    transition: all 0.3s ease;
}

.avatar-container:hover #avatarImage {
    transform: scale(1.05);
    filter: brightness(1.1);
}

/* Floating animation for background elements */
@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    33% { transform: translateY(-10px) rotate(1deg); }
    66% { transform: translateY(5px) rotate(-1deg); }
}

/* Enhanced focus states */
.form-input:focus {
    transform: translateY(-1px);
    box-shadow: 0 4px 20px rgba(236, 72, 153, 0.15);
}

/* Success animation for save button */
@keyframes successPulse {
    0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
    100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
}

.success-animation {
    animation: successPulse 0.6s ease-out;
}

/* Responsive improvements */
@media (max-width: 768px) {
    .tab-button {
        font-size: 0.875rem;
        padding: 0.75rem 0.25rem;
    }
    
    .tab-button svg {
        width: 1rem;
        height: 1rem;
    }
    
    .glass-effect {
        margin: 0.5rem;
        border-radius: 1rem;
    }
}
</style>
{% endblock %}